'use client'

import { useMemo, useState } from 'react'
import ListGridControl from '@/components/shared/Control/list-grid-control'
import { CourseCategory } from '@/types/category'
import CategoryGroupItem from './category-group-item'
import { ArrowRight, Loader2 } from 'lucide-react'

type ViewMode = 'grid' | 'list'
interface CourseListProps {
  title?: string
  subTitle?: string
  data?: CourseCategory | null
}
const CategoryGroup = ({
  title = '',
  subTitle = 'Học viên muốn đạt điểm cao tuyệt đối',
  data,
}: CourseListProps) => {
  const [viewMode, setViewMode] = useState<ViewMode>('grid')
  const [selectSort, setSelectSort] = useState<string>()
  console.log('selectSort', selectSort)

  const sortByCate = useMemo(() => {
    return data?.children ?? []
  }, [data])
  // console.log("data course", data);
  const courseFiltered = useMemo(() => {
    if (!selectSort || selectSort === 'all') return data?.children
    return data?.children?.filter((i) => i.name === selectSort)
  }, [data, selectSort])

  console.log('courseFiltered', courseFiltered)
  const handleViewMode = (type: ViewMode) => {
    setViewMode(type)
  }

  const handleSelectSort = (value: string) => {
    setSelectSort(value)
  }

  if (!data) return null
  return (
    <section className="py-16 bg-background">
      <div className="container mx-auto px-4">
        {title && subTitle && (
          <div className="flex items-center justify-between mb-6">
            <div>
              <h3 className="text-2xl md:text-3xl font-bold text-primary">
                {title}
              </h3>
              <p className="text-muted-foreground mt-1">
                {subTitle}
              </p>
            </div>
          </div>
        )}
        {/* Controls */}
        <ListGridControl
          items={sortByCate}
          onChangeView={handleViewMode}
          onSelectSort={handleSelectSort}
        />

        {/* Course Section */}
        <div className="space-y-10">
          {courseFiltered?.map((item, index) => {
            return (
              <CategoryGroupItem
                key={item.slug ?? `idx-${index}`}
                group={item}
                viewMode={viewMode}
              />
            )
          })}
        </div>
      </div>
      <div className="flex justify-center mt-8">
        <button
          className="text-primary font-semibold inline-flex items-center group"
          onClick={() => {}}
        // disabled={loadMore}
        >
           Xem thêm
          <ArrowRight className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" />
        </button>
      </div>
    </section>
  )
}

export default CategoryGroup
